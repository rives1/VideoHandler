unit frmMain;

interface

uses System.SysUtils, System.Types, System.UITypes, System.Classes,
  System.Variants, FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics,
  FMX.Dialogs, FMX.Menus, FMX.StdCtrls, FMX.Controls.Presentation, FMX.Media,
  FMX.Layouts, FMX.MultiView, FMX.ListView.Types, FMX.ListView.Appearances,
  FMX.ListView.Adapters.Base, FMX.ListView, FMX.Edit, FMX.SearchBox,
  FMX.ListBox, Data.Bind.GenData, System.Rtti, System.Bindings.Outputs,
  FMX.Bind.Editors, Data.Bind.EngExt, FMX.Bind.DBEngExt, Data.Bind.Components,
  Data.Bind.ObjectScope, FMX.StdActns, System.Actions, FMX.ActnList,
  System.Math.Vectors, FMX.Controls3D, FMX.Layers3D;

type
  TForm1 = class(TForm)
    _mp: TMediaPlayer;
    StatusBar1: TStatusBar;
    MainMenu1: TMainMenu;
    MenuItem1: TMenuItem;
    MenuItem4: TMenuItem;
    _layList: TLayout;
    _fl: TListView;
    Layout2: TLayout;
    layPlayer: TLayout;
    MediaPlayerControl1: TMediaPlayerControl;
    layCtrl: TLayout;
    _pos: TTrackBar;
    _vol: TTrackBar;
    ActionList1: TActionList;
    MediaPlayerStart1: TMediaPlayerStart;
    MediaPlayerStop1: TMediaPlayerStop;
    MediaPlayerCurrentTime1: TMediaPlayerCurrentTime;
    MediaPlayerVolume1: TMediaPlayerVolume;
    MediaPlayerPlayPause1: TMediaPlayerPlayPause;
    Button1: TButton;
    Button2: TButton;
    Splitter1: TSplitter;
    OpenDialog1: TOpenDialog;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure _flKeyDown(Sender: TObject; var Key: Word; var KeyChar: Char;
      Shift: TShiftState);
  private
    { Private declarations }
    procedure _fillFiles(_pDir: string);
    procedure _shortcut(_pKey: Word);
  public
    { Public declarations }
  end;

var Form1: TForm1;

implementation

{$R *.fmx}

procedure TForm1.Button1Click(Sender: TObject);
begin
  // carico una lista
  _fillFiles('x:\HD\HD\');
end;

procedure TForm1.Button2Click(Sender: TObject);
begin
  _mp.FileName := _fl.Selected.TagString;
  _mp.Play;
end;

procedure TForm1._fillFiles(_pDir: string);
// carico i file della cartella
var _file: TListViewItem; SR: TSearchRec;
begin
  if _pDir <> '' then begin
    _fl.items.Clear();

    FindFirst(_pDir + '*.*', faAnyFile, SR);
    try
      repeat
        if ((SR.Attr and faDirectory) = 0) then begin
          _file := _fl.items.Add;
          _file.Text := SR.Name;
          _file.Detail := DateTimeToStr(SR.TimeStamp) + ' ' + SR.Size.ToString;
          _file.TagString := _pDir + SR.Name;
        end;

      until (FindNext(SR) <> 0);
    finally FindClose(SR);
    end;
  end;

end;

procedure TForm1._flKeyDown(Sender: TObject; var Key: Word; var KeyChar: Char;
  Shift: TShiftState);
begin
  _shortcut(Key);
end;

procedure TForm1._shortcut(_pKey: Word);
// shotcut per eseguire le funzioni
begin
  // barra spaziatrice start/stop
  if _pKey = 0 then begin
    if _fl.Selected <> nil then begin
      _mp.FileName := _fl.Selected.TagString;
      _mp.Play;
    end;
  end;

end;

end.
